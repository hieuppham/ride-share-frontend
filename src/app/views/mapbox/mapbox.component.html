<div id="main-container">
    <div id="map" class="h-100"></div>
    <div id="table-container" class="w-100 d-none">
        <table id="table_id" class="display stripe hover order-column">
            <thead>
                <tr>
                    <th class="text-center"></th>
                    <th class="text-center">Phương tiện</th>
                    <th>Bắt đầu</th>
                    <th>Kết thúc dự kiến</th>
                    <th>Khoảng cách</th>
                    <th>Tiêu chí</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<div id="form-share-container">
    <!-- share form -->
    <form id="form-ride-share" [formGroup]="formShareRide">
        <div>
            <input formControlName="uid" class="d-none">
            <input formControlName="distance" _ngcontent-ajb-c205="" id="distance-measure-share" type="tet"
                readonly="true"
                class="distance-container mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl"
                placeholder="0.0km">

            <input formControlName="startTime"
                class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl" type="datetime-local"
                id="time-start-share">
            <input formControlName="endTime" class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl"
                type="datetime-local" id="time-end">
            <select formControlName="vehicle"
                class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl">
                <option *ngFor="let v of this.user?.vehicles; let i = index" [value]="v.name">{{v.name}}
                </option>
            </select>
            <input formControlName="criterions"
                class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl" type="text" id="criterions"
                placeholder="Tiêu chí">
            <div id="text-share-wrapper" class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl">
                <textarea formControlName="note" id="note" cols="27" rows="5" placeholder="Ghi chú"></textarea>
            </div>
        </div>
        <button id="btn-form-submit" type="button" [cModalToggle]="shareConfirmModal.id"
            class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl green-background-white-text">Xác
            nhận</button>
    </form>
    <!-- end share form-->
    <!-- toggle share form -->
    <button id="btn-toggle-share" class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl"
        (click)="toggleFormShare()">Chia sẻ chuyến
        đi</button>
    <!-- end toggle share form -->
</div>

<div id="search-user" class="mapboxgl-ctrl-geocoder mapboxgl-ctrl">
    <svg class="mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-search" viewBox="0 0 18 18"
        xml:space="preserve" width="18" height="18">
        <path
            d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z">
        </path>
    </svg>
    <input type="text" class="mapboxgl-ctrl-geocoder--input" placeholder="Tìm người dùng"
        title="Tìm người dùng theo SĐT, email và tên" aria-label="Tìm người dùng theo SĐT, email và tên"
        (keyup)="onSearchUser($event)">
    <div class="suggestions-wrapper">
        <ul class="suggestions">
            <ng-container *ngFor="let u of searchUserResult">
                <li (click)="toggleSearchUserModal(u)">
                    <a>
                        <div class="mapboxgl-ctrl-geocoder--suggestion">
                            <div class="mapboxgl-ctrl-geocoder--suggestion-title">{{u.fullName}}</div>
                            <div class="mapboxgl-ctrl-geocoder--suggestion-address">{{u.email}}</div>
                        </div>
                    </a>
                </li>
            </ng-container>
        </ul>
    </div>
    <div class="mapboxgl-ctrl-geocoder--pin-right"><button aria-label="Clear" class="mapboxgl-ctrl-geocoder--button"
            style="display: none;"><svg class="mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-close"
                viewBox="0 0 18 18" xml:space="preserve" width="18" height="18">
                <path
                    d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z">
                </path>
            </svg></button><svg class="mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-loading"
            viewBox="0 0 18 18" xml:space="preserve" width="18" height="18" style="display: none;">
            <path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path>
            <path opacity=".1"
                d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z">
            </path>
        </svg></div>
</div>

<!-- search user modal -->
<c-modal #searchUserModal alignment="center" id="showSearchUserModal" [visible]="searchUserModalVisible">
    <c-modal-header>
        <h5 cModalTitle>Thông tin người dùng</h5>
        <button (click)="toggleSearchUserModal()"
            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input fit-width" cButton>
            Đóng</button>
    </c-modal-header>
    <c-modal-body>
        <div>
            <c-avatar id="user-avatar" shape="rounded-1" size="xl" src="{{chosenSearchUser?.photoUrl}}"
                class="avatar avatar-md rounded-1 text-primary">
            </c-avatar>
            <p>{{chosenSearchUser?.fullName}}</p>
            <p>{{gender(chosenSearchUser?.gender!)}}</p>
            <p>{{chosenSearchUser?.phone}}</p>
            <p>{{chosenSearchUser?.email}}</p>
            <p>{{chosenSearchUser?.vehicles}}</p>
        </div>
    </c-modal-body>
    <c-modal-footer>
        <div class="modal-footer">
            <button
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input gray-background-white-text"
                cButton type="button" (click)="toggleSearchUserModal()">Xóa</button>
            <button
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input green-background-white-text"
                cButton type="button" (click)="toggleSearchUserModal()">Liên hệ
            </button>
        </div>
    </c-modal-footer>
</c-modal>
<!-- end search user modal -->

<!-- show my ride -->
<button (click)="toggleMyRidesModal()" id="btn-toggle-show-my-rides"
    class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl">
    Chuyến của tôi
</button>

<!-- my rides modal -->
<c-modal #myRidesModal alignment="center" id="myRidesModal" [visible]="myRidesModalVisible" scrollable>
    <c-modal-header>
        <h5 cModalTitle>Danh sách chuyến đi</h5>
        <button (click)="toggleMyRidesModal()"
            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input fit-width" cButton>
            Đóng</button>
    </c-modal-header>
    <c-modal-body>
        <ng-container *ngFor="let ride of rideUser; let i = index">
            <div class="ride-user mapboxgl-ctrl-geocoder mapboxgl-ctrl list-item" (click)="toggleEditMyRideModal(ride)">
                <p class="text-center"><span class="hl hl-green">{{dateToStr(ride.startTime)}}</span><span
                        class="hl hl-red">{{dateToStr(ride.endTime)}}</span>
                <p>Khoảng cách <span class="hl hl-yellow">{{ride.distance}} km</span></p>
                <p>Phương tiện <span class="hl hl-deepblue">{{ride.vehicle.name}}</span></p>
            </div>
        </ng-container>
    </c-modal-body>
</c-modal>
<!-- end my rides modal -->

<c-modal #editMyRideModal alignment="center" id="editMyRideModal" [visible]="editMyRideModalVisible">
    <c-modal-header>
        <h5 cModalTitle>Thông tin chuyến đi</h5>
        <button (click)="toggleEditMyRideModal()" id="btn-close-modal"
            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input fit-width" cButton>
            Đóng
        </button>
    </c-modal-header>
    <c-modal-body>
    </c-modal-body>
    <c-modal-footer>
        <div class="modal-footer">
            <button (click)="toggleEditMyRideModal()"
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input green-background-white-text"
                cButton>Lưu thông tin</button>
        </div>
    </c-modal-footer>
</c-modal>

<!-- modal confirm  -->
<c-modal #shareConfirmModal alignment="center" id="shareConfirmModal" [visible]="false">
    <c-modal-header>
        <h5 cModalTitle>Chia sẻ chuyến đi này?<b>
            </b></h5>
    </c-modal-header>
    <!-- div thong tin chuyen di -->
    <c-modal-footer>
        <div class="modal-footer">
            <button
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input gray-background-white-text"
                cButton type="button" [cModalToggle]="shareConfirmModal.id">Hủy</button>
            <button
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input green-background-white-text"
                cButton type="button" [cModalToggle]="notifyAddRideModal.id" (click)="onSubmitFormShare()">Chia
                sẻ
            </button>
        </div>
    </c-modal-footer>
</c-modal>
<!-- end modal confirm -->

<!-- notify -->
<c-modal #notifyAddRideModal alignment="center" id="notifyAddRideModal" [visible]="false">
    <c-modal-header>
        <h5 cModalTitle><b>Thành công</b></h5>
    </c-modal-header>
    <c-modal-body>
        <p>Chuyến đi của bạn đã được lưu lại và chờ duyệt</p>
    </c-modal-body>
</c-modal>
<!-- end notify -->

<div class="mapboxgl-ctrl-top-center">
    <button id="btn-toggle-profile" (click)="toggleUserInfoModal()" cButton class="py-0 nav-link btn"
        ng-reflect-caret="false">
        <c-avatar ctextcolor="primary" shape="rounded-1" size="md" src="{{this.user?.photoUrl}}"
            class="avatar avatar-md rounded-1 text-primary">
        </c-avatar>
    </button>
    <button (click)="navigateToAdminPage()" id="btn-admin-page"
        class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input hl-red">
        Trang quản trị
    </button>
</div>

<c-modal #rideInfoModal alignment="center" id="rideInfoModal" [visible]="rideInfoModalVisible">
    <c-modal-header>
        <h5 cModalTitle>Thông tin chuyến đi</h5>
        <button [cModalToggle]="rideInfoModal.id" id="btn-close-modal"
            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input" cButton>
            Đóng
        </button>
    </c-modal-header>
    <c-modal-body>
        <h3 class="text-center">A -> B</h3>
        <p class="text-center"><span class="hl hl-green">{{dateToStr(chosenRide?.startTime)}}</span><span
                class="hl hl-red">{{dateToStr(chosenRide?.endTime)}}</span></p>
        <p>Khoảng cách <span class="hl hl-yellow">{{chosenRide?.distance}} km</span></p>
        <p>Phương tiện
            <span class="hl hl-deepblue">{{vehicle(chosenRide?.vehicle?.type!)}} {{chosenRide?.vehicle?.name}}
                {{chosenRide?.vehicle?.licensePlateNumber}}</span>
        </p>
        <p>Yêu cầu
            <ng-container *ngFor="let c of chosenRide?.criterions">
                <span class="hl hl-lightgrey">{{c}}</span>
            </ng-container>
            <hr>
        <p>Chủ xe <b>{{chosenRide?.user?.fullName}}</b></p>
        <p>Giới tính <b>{{gender(chosenRide?.user?.gender!)}}</b> </p>
        <p>Số điện thoại <b>{{chosenRide?.user?.phone}}</b> </p>
        <p>Email <b>{{chosenRide?.user?.email}}</b></p>
        <hr>
        <p>Ghi chú </p>
        <span>{{chosenRide?.note}}</span>
    </c-modal-body>
    <c-modal-footer>
        <div class="modal-footer">
            <button
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input green-background-white-text"
                cButton [cModalToggle]="rideInfoModal.id">Liên hệ chủ xe</button>
        </div>
    </c-modal-footer>
</c-modal>

<!-- user info -->
<c-modal #userInfoModal size="xl" alignment="center" id="userInfoModal" [visible]="userInfoModalVisible">
    <c-modal-header>
        <h5 cModalTitle>Thông tin người dùng</h5>
        <button (click)="toggleUserInfoModal()" id="btn-close-modal"
            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input fit-width" cButton>
            Đóng
        </button>
    </c-modal-header>
    <form id="form-user-info" [formGroup]="formUserInfo">
        <c-modal-body>
            <div id="user-info">
                <c-avatar id="user-avatar" shape="rounded-1" size="xl" src="{{this.user?.photoUrl}}"
                    class="avatar avatar-md rounded-1 text-primary">
                </c-avatar>
                <div id="input-user-info">
                    <div id="text-user-info">
                        <input formControlName="uid" type="text" class="d-none">

                        <input formControlName="fullName" id="full-name" type="text"
                            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input"
                            placeholder="Tên đầy đủ" required>

                        <input formControlName="dob" id="dob" type="date"
                            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input"
                            placeholder="Ngày sinh" required>

                        <select formControlName="gender" id="gender"
                            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input">
                            <option value="both" selected>Giới tính</option>
                            <option value="female">Nữ</option>
                            <option value="male">Nam</option>
                        </select>

                        <input formControlName="phone" id="phone" type="text"
                            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input"
                            placeholder="Số điện thoại" required>

                        <input formControlName="email" id="email" type="text"
                            class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input"
                            placeholder="Email" readonly>
                    </div>
                    <div id="img-user-info">
                        <input *ngIf="_tmpImg.userIdImage" [src]="_tmpImg.userIdImage" height="200px" width="200px"
                            type="image">
                        <input formControlName="userIdImage" type="file" (change)="onSelectFile($event, 'userIdImage')">
                        <div formArrayName="vehicles" id="vehicles">
                            <div *ngFor="let v of vehicles.controls; let i = index">
                                <div class="vehicle-info" [formGroupName]="i">
                                    <select [id]="'type-'+i" formControlName="type"
                                        class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl">
                                        <option value="motobike" selected>Xe máy</option>
                                        <option value="car">Ô tô</option>
                                    </select>

                                    <input [id]="'vehicle-' + i" type="text"
                                        class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl"
                                        formControlName="name" placeholder="Tên phương tiện">

                                    <!-- image -->
                                    <input *ngIf="_tmpImg.vehicleImages[i] && _tmpImg.vehicleImages[i].vehicleImage"
                                        [src]="_tmpImg.vehicleImages[i].vehicleImage" height="200px" width="200px"
                                        type="image">
                                    <input type="file" formControlName="vehicleImage"
                                        (change)="onSelectFile($event, 'vehicleImage', i)">
                                    <!-- end image -->

                                    <input [id]="'lpn-' + i" type="text"
                                        class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl"
                                        formControlName="licensePlateNumber" placeholder="Biển số">
                                    <!-- license plate number image -->
                                    <input *ngIf="_tmpImg.vehicleImages[i] && _tmpImg.vehicleImages[i].lpnImage"
                                        [src]="_tmpImg.vehicleImages[i].lpnImage" height="200px" width="200px"
                                        type="image">
                                    <input type="file" formControlName="lpnImage"
                                        (change)="onSelectFile($event, 'lpnImage', i)">

                                    <!-- end license plate number image -->

                                    <button class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl"
                                        (click)="removeVehicle(i)">-</button>
                                </div>
                            </div>
                        </div>
                        <button class="mapboxgl-ctrl-geocoder--input mapboxgl-ctrl-geocoder mapboxgl-ctrl"
                            (click)="addVehicle()">+</button>
                    </div>
                </div>
            </div>
        </c-modal-body>
        <c-modal-footer>
            <div class="modal-footer">
                <button
                    class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input green-background-white-text"
                    cButton (click)="toggleUserInfoModal(); onSubmitFormUserInfo()">Cập
                    nhật thông tin</button>
                <button
                    class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input gray-background-white-text"
                    cButton type="button" (click)="toggleConfirmSignOutModal()">Đăng
                    xuất
                </button>
            </div>
        </c-modal-footer>
    </form>
</c-modal>
<!-- end user info -->

<c-modal #confirmSignOutModal alignment="center" id="confirmSignOutModal" [visible]="confirmSignOutModalVisible">
    <c-modal-header>
        <h5 cModalTitle>Bạn muốn đăng xuất?</h5>
    </c-modal-header>
    <c-modal-footer>
        <div class="modal-footer">
            <button
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input green-background-white-text"
                cButton (click)="toggleConfirmSignOutModal()">Hủy</button>
            <button
                class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input gray-background-white-text"
                cButton type="button" (click)="toggleConfirmSignOutModal(); signOutApp()">Đăng xuất
            </button>
        </div>
    </c-modal-footer>
</c-modal>

<div id="toggle-table-container">
    <button id="btn-toggle-table" title="Ctrl + X"
        class="mapboxgl-ctrl-geocoder mapboxgl-ctrl mapboxgl-ctrl-geocoder--input green-background-white-text fit-width"
        type="button" (click)="toggleDataTable()">Danh sách chuyến</button>
</div>